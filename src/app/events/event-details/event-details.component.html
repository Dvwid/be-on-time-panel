<div class="w-full">
  <div class="flex justify-between px-10 py-8 w-full">
    <div class="flex flex-col">
      <span class="text-xl font-medium">{{event?.eventDetails?.name}}</span>
      <span *ngIf="event?.ended && event?.eventDetails?.dateTo">To wydarzenie zakończyło się.</span>
      <span *ngIf="(event?.started && !event?.ended) || (event?.started && !event?.eventDetails?.dateTo)">To wydarzenie rozpoczęło się.</span>
      <span *ngIf="event?.ended" class="text-xs text-primary cursor-pointer mt-2">
        Wyświetl opinie użytkowników
      </span>
    </div>

    <div class="flex items-center gap-1"
         *ngIf="event && !event?.started">
      <app-icon-button (click)="changeDeclarationOfParticipation(userJoinDeclarationStatusEnum.CONFIRMED)"
                       [btnStyle]="currentUserJoinDeclarationStatus === userJoinDeclarationStatusEnum.CONFIRMED ? 'primary' : 'outlined'"
                       [showSpinner]="isJoining$ | async"
                       icon="check"
                       label="Wezmę udział">
      </app-icon-button>

      <app-icon-button (click)="changeDeclarationOfParticipation(userJoinDeclarationStatusEnum.TENTATIVE)"
                       [showSpinner]="isJoining$ | async"
                       [btnStyle]="currentUserJoinDeclarationStatus === userJoinDeclarationStatusEnum.TENTATIVE ? 'primary' : 'outlined'"
                       icon="question_mark"
                       label="Może">
      </app-icon-button>

      <app-icon-button (click)="changeDeclarationOfParticipation(userJoinDeclarationStatusEnum.DECLINED)"
                       [showSpinner]="isJoining$ | async"
                       [btnStyle]="currentUserJoinDeclarationStatus === userJoinDeclarationStatusEnum.DECLINED ? 'primary' : 'outlined'"
                       icon="close"
                       label="Nie wezmę udziału">
      </app-icon-button>
    </div>

    <div class="flex flex-col items-center justify-center gap-1 text-xs"
         *ngIf="event?.ended">
      <div>Ocena wydarzenia: {{rating}} / {{starCount}}</div>

      <app-star-rating [rating]="rating"
                       [disabled]="isRatingDisabled"
                       [starCount]="starCount"
                       [color]="starColor"
                       (ratingUpdated)="onRatingChanged($event)">
      </app-star-rating>
    </div>
  </div>
</div>

<div class="flex w-full gap-20 px-10 relative">
  <div *ngIf="event?.imageInfo?.imageId"
       id="image-wrapper"
       class="w-1/2 z-10"
       [style.min-height.vh]="30">
  </div>
  <div class="w-1/2 absolute top-0 left-0 px-10 z-0">
    <div class="skeleton w-full rounded-2xl" [style.min-height.vh]="30"></div>
  </div>
  <div *ngIf="!event?.imageInfo?.imageId" class="w-1/2 z-10">
    <img src="assets/images/event-default.jpg" alt="default-image" class="preview-event-image">
  </div>
  <div class="flex flex-col gap-3 w-1/2">
    <div class="w-full">
      <span class="font-bold menu-section-label">ORGANIZATOR</span>
      <app-event-initiator [initiatorInfo]="event?.initiatorInfo"></app-event-initiator>
    </div>

    <div class="w-full">
      <span class="font-bold menu-section-label">{{event?.ended ? 'Wzieli udział' : 'Wezmą udział'}}</span>
      <div class="flex flex-wrap gap-3 items-center"
           [style.min-height.px]="30">
        <img src="assets/images/user-icon.png"
             alt="participant"
             *ngFor="let participant of event?.participantsInfo?.confirmedParticipants.slice(0, 5)"
             [matTooltip]="participant.participantName"
             [style.width.px]="30"
             [style.height.px]="30"/>
        <div *ngIf="event?.participantsInfo?.confirmedParticipants?.length > 5"
             class="bg-gray-300 rounded-full flex items-center justify-center"
             [style.width.px]="30"
             [style.height.px]="30">
          + {{event?.participantsInfo?.declinedParticipants.slice(5).length}}
        </div>
      </div>
    </div>

    <div class="w-full">
      <span class="font-bold menu-section-label">Może</span>
      <div class="flex flex-wrap gap-3 items-center"
           [style.min-height.px]="30">
        <img src="assets/images/user-icon.png"
             alt="participant"
             *ngFor="let participant of event?.participantsInfo?.tentativeParticipants.slice(0, 5)"
             [matTooltip]="participant.participantName"
             [style.width.px]="30"
             [style.height.px]="30"/>
        <div *ngIf="event?.participantsInfo?.tentativeParticipants?.length > 5"
             class="bg-gray-300 rounded-full flex items-center justify-center"
             [style.width.px]="30"
             [style.height.px]="30">
          + {{event?.participantsInfo?.declinedParticipants.slice(5).length}}
        </div>
      </div>
    </div>

    <div class="w-full">
      <span class="font-bold menu-section-label">Niezainteresowani</span>
      <div class="flex flex-wrap gap-3 items-center"
           [style.min-height.px]="30">
        <img src="assets/images/user-icon.png"
             alt="participant"
             *ngFor="let participant of event?.participantsInfo?.declinedParticipants.slice(0, 5)"
             [matTooltip]="participant.participantName"
             [style.width.px]="30"
             [style.height.px]="30"/>

        <div *ngIf="event?.participantsInfo?.declinedParticipants?.length > 5"
             class="bg-gray-300 rounded-full flex items-center justify-center"
             [style.width.px]="30"
             [style.height.px]="30">
          + {{event?.participantsInfo?.declinedParticipants.slice(5).length}}
        </div>
      </div>
    </div>
  </div>
</div>


<div class="flex flex-col gap-5 px-10 py-12">
  <div class="flex gap-20 w-full">
    <div class="flex flex-col gap-1 w-1/2">
      <span class="font-bold menu-section-label">OPIS WYDARZENIA</span>
      <span class="whitespace-pre-wrap text-xs">{{event?.eventDetails?.description}}</span>
    </div>
    <div class="flex flex-col gap-1 w-1/2">
      <span class="font-bold menu-section-label">TERMIN</span>
      <app-event-time [event]="event"></app-event-time>
    </div>
  </div>
</div>

<div class="flex w-full gap-20 px-10 pb-10">
  <div class="w-1/2">
    <span class="font-bold menu-section-label">MIEJSCE NA MAPIE</span>
    <app-mapbox-wrapper *ngIf="event?.eventLocation?.lat && event?.eventLocation?.lng"
                        [lngLat]="[event?.eventLocation?.lng, event?.eventLocation?.lat]"
                        [readonly]="true">
    </app-mapbox-wrapper>

    <div *ngIf="!event?.eventLocation?.lat || !event?.eventLocation?.lng"
         [style.height.px]="240"
         class="flex flex-col items-center gap-3 rounded-2xl py-3 border border-sky-500">
      <img src="assets/images/no-location.jpg"
           alt="no-location"
           [style.height.px]="150"/>
      <span class="w-3/4 text-center">
        Podgląd na mapie jest obecnie niedostępny.
      </span>
    </div>
  </div>

  <div class="w-1/2">
    <span class="font-bold menu-section-label">ADRES WYDARZENIA</span>
    <app-event-place [eventLocation]="event?.eventLocation"></app-event-place>
  </div>
</div>


